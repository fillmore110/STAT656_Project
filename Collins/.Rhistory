RefittlassoOut = cv.glmnet(Xtraining ,Ytraining, alpha=1)
betaHatTemp = coef(RefittlassoOut,s='lambda.1se')[-1]
Srefitted = which(abs(betaHatTemp) > 1e-16)
Xtrainingdf = as.data.frame(Xtraining[,Srefitted])
refittedOut = lm(Ytraining ~ ., data = Xtrainingdf)
betaHatRefitted = coef(refittedOut)
XtestingDF = as.data.frame(Xtesting[,Srefitted])
#Predictions & Sq Error Loss -  Refitted Lasso
predRefittTrain = predict(refittedOut, Xtrainingdf)
SqErrorRefittTrain <- mean((predRefittTrain - Ytraining)**2)
predRefittTest = predict(refittedOut, XtestingDF)
SqErrorRefittTest <- mean((predRefittTest - Ytesting)**2)
residuals        =  Ytraining - predRefittTrain
residualPlotData = data.frame(residuals, predRefittTrain)
ggplot(data = residualPlotData) +
geom_point(aes(x = predRefittTrain, y = residuals)) +
geom_hline(yintercept = 0, color = 'red')
#Visualization correlated variables
Xcorr = cor(Xtraining[,Srefitted])
corrplot(Xcorr, order = "hclust", tl.cex = 0.75)
#Predictions & Sq Error Loss -  Refitted Lasso
XtestDF = as.data.frame(Xtest[,Srefitted])
Predictions = predict(refittedOut, XtestDF)
### get preds:
Yhat = data.frame('Yhat' = Predictions)
#write.table
if(yourName == 'firstLast'){
print('Xochitlquetzal Collins')
}else{
fName = paste(c(yourName,'Predictions.txt'),collapse='')
write.table(Yhat,file=fName,row.names=FALSE,col.names=FALSE)
}
`refittedOut`
betaHatRefitted
abs(betaHatRefitted)
abs(betaHatRefitted) > 0.5
selectedFeatures = abs(betaHatRefitted) > 0.5
featureNames[selectedFeatures]
betaHatRefitted[selectedFeatures]
barplot(betaHatRefitted[selectedFeatures],horiz=T,
cex.names=.5,las=1,xlim=c(-1,1),names.arg = names(selectedFeatures))
names(selectedFeatures)
names(betaHatRefitted[selectedFeatures])
selectedFeatures = abs(betaHatRefitted) > 0.5
barplot(betaHatRefitted[selectedFeatures],horiz=T,
cex.names=.5,las=1,xlim=c(-1,1),names.arg = names(betaHatRefitted[selectedFeatures]))
barplot(betaHatRefitted[selectedFeatures],horiz=T,
cex.names=.75,las=1,xlim=c(-1,1),names.arg = names(betaHatRefitted[selectedFeatures]))
selectedFeatures = abs(betaHatRefitted) > 1
barplot(betaHatRefitted[selectedFeatures],horiz=T,
cex.names=.75,las=1,xlim=c(-1,1),names.arg = names(betaHatRefitted[selectedFeatures]))
library(shiny); runApp('D:/TAMU/656 Applied Analytics/STAT656_Project/Collins/apptesting.R')
runApp('D:/TAMU/656 Applied Analytics/STAT656_Project/Collins/apptesting.R')
#require(caret)
#require(quantmod)
require(dplyr)
require(tidyverse)
require(tidyquant)
require(lubridate)
require(ggplot2)
require(reshape2)
require(dtw)
require(dtwclust)
require(TSclust)
require(timetk)
require(cluster)
require(factoextra)
require(dendextend)
rm(list=ls())
#Get Stock Index
stockIndex = tq_index("SP500") #SP500
#Fix stock symbols
stockIndex$symbolFixed = gsub("\\.", "-",stockIndex$symbol)
#Get Quantitative Data
startDate = "2017-01-01"
endDate = "2021-02-28"
#complete_cases = TRUE - removes symbols that return an NA
stockPrices <- tq_get(stockIndex$symbolFixed, get = "stock.prices", from = startDate, to =endDate, complete_cases = TRUE )
save(stockPrices, file="stockDatasp500-4year.Rdata")
load("stockDatasp500-4year.Rdata")
returnsDaily <- stockPrices %>%
group_by(symbol) %>%
tq_transmute(select = adjusted,
mutate_fun = periodReturn,
period = "daily",
type = "log",
col_rename='returns') %>%
separate(date, into = c('year', 'month', 'day'))
returnsMonthly <- stockPrices %>%
group_by(symbol) %>%
tq_transmute(select = adjusted,
mutate_fun = periodReturn,
period = "monthly",
type = "log",
col_rename='returns') %>%
separate(date, into = c('year', 'month', 'day'))
returnsMonthly$Help <- paste(returnsMonthly$symbol, returnsMonthly$year, returnsMonthly$month)
returnsYearly <- stockPrices %>%
group_by(symbol) %>%
tq_transmute(select = adjusted,
mutate_fun = periodReturn,
period = "yearly",
type = "log",
col_rename='returns') %>%
separate(date, into = c('year', 'month', 'day'))
returnsYearly$Help <- paste(returnsYearly$symbol, returnsYearly$year)
volMonthly <- returnsDaily %>%
group_by(symbol, year, month) %>%
summarise(sd = sd(returns)) %>%
arrange(symbol, year, month)
volMonthly$Help <- paste(volMonthly$symbol, volMonthly$year, volMonthly$month)
volYearly <- returnsDaily %>%
group_by(symbol, year) %>%
summarise(sd = sd(returns)) %>%
arrange(symbol)
volYearly$Help <- paste(volYearly$symbol, volYearly$year)
dataYearly <- left_join(returnsYearly, volYearly, by = c("Help" = "Help"))
dataYearly <- dataYearly %>%
select('symbol.x','year.x','returns','sd') %>%
rename('symbol'='symbol.x', 'year'='year.x' )
dataMonthly <- left_join(returnsMonthly, volMonthly, by = c("Help" = "Help"))
dataMonthly <- dataMonthly %>%
select('symbol.x','year.x','month.x','returns','sd') %>%
rename('symbol'='symbol.x', 'month' = 'month.x','year'='year.x' )
dataMonthly$YrMo <- paste(dataMonthly$year, dataMonthly$month, sep = "")
dataMonthly <- dataMonthly %>% relocate('symbol','YrMo','year','month','returns','sd')
save(dataYearly, file="YearlyReturnsSDsp500-4year.Rdata")
save(dataMonthly, file="MonthlyReturnsSDsp500-4year.Rdata")
input = data.frame(start_date = '2019-12-03', end_date='2020-04-05',num_clusters=3)
dataMonthly_subset =  dataMonthly %>%
filter(YrMo >= format(as.Date(input$start_date, format="%Y-%m-%d"),"%Y%m")
& YrMo <= format(as.Date(input$end_date, format="%Y-%m-%d"),"%Y%m")) %>%
select('symbol', 'YrMo', 'returns','sd')
mls <- split(dataMonthly_subset, f=dataMonthly_subset$YrMo)
myv <- c("returns","sd")
kls <- lapply(X=mls, FUN=function(x){x$clust <- kmeans(x[, myv],
centers=2)$cluster ; return(x)})
finaldf <- do.call(rbind, kls)
finaldf
runApp('D:/TAMU/656 Applied Analytics/STAT656_Project/Collins/apptesting.R')
runApp('D:/TAMU/656 Applied Analytics/STAT656_Project/Collins/apptesting.R')
runApp('D:/TAMU/656 Applied Analytics/STAT656_Project/Collins/apptesting.R')
library(shiny); runApp('D:/TAMU/656 Applied Analytics/STAT656_Project/Collins/apptesting.R')
runApp('D:/TAMU/656 Applied Analytics/STAT656_Project/Collins/apptesting.R')
runApp('D:/TAMU/656 Applied Analytics/STAT656_Project/Collins/apptesting.R')
runApp('D:/TAMU/656 Applied Analytics/STAT656_Project/Collins/apptesting.R')
load('sp500-4year.RData')
setwd("D:/TAMU/656 Applied Analytics/STAT656_Project/Collins")
load('sp500-4year.RData')
load('YearlyReturnsSDsp500-4year.RData')
load('MonthlyReturnsSDsp500-4year.RData')
sp500Sectors = read.csv("constituents_csv.csv") %>%
mutate(sectorF = as.factor(Sector)) %>%
mutate(sectorNumeric = as.numeric(sectorF))
sp500Sectors$sectorF
unique(sp500Sectors$sectorF)
sort(unique(sp500Sectors$sectorF))
runApp('apptesting2.R')
runApp('apptesting2.R')
runApp('apptesting2.R')
runApp('apptesting2.R')
#require(caret)
#require(quantmod)
require(dplyr)
require(tidyverse)
require(tidyquant)
require(lubridate)
require(ggplot2)
require(reshape2)
require(dtw)
require(dtwclust)
require(TSclust)
require(timetk)
require(cluster)
require(factoextra)
require(dendextend)
rm(list=ls())
input = data.frame(start_date = '2019-12-03', end_date='2020-04-05',num_clusters=3)
dataMonthly_subset =  dataMonthly %>%
filter(YrMo >= format(as.Date(input$start_date, format="%Y-%m-%d"),"%Y%m")
& YrMo <= format(as.Date(input$end_date, format="%Y-%m-%d"),"%Y%m")) %>%
select('symbol', 'YrMo', 'returns','sd')
#require(caret)
#require(quantmod)
require(dplyr)
require(tidyverse)
require(tidyquant)
require(lubridate)
require(ggplot2)
require(reshape2)
require(dtw)
require(dtwclust)
require(TSclust)
require(timetk)
require(cluster)
require(factoextra)
require(dendextend)
rm(list=ls())
#Get Stock Index
stockIndex = tq_index("SP500") #SP500
#Fix stock symbols
stockIndex$symbolFixed = gsub("\\.", "-",stockIndex$symbol)
#Get Quantitative Data
startDate = "2017-01-01"
endDate = "2021-02-28"
#complete_cases = TRUE - removes symbols that return an NA
stockPrices <- tq_get(stockIndex$symbolFixed, get = "stock.prices", from = startDate, to =endDate, complete_cases = TRUE )
save(stockPrices, file="stockDatasp500-4year.Rdata")
load("stockDatasp500-4year.Rdata")
returnsDaily <- stockPrices %>%
group_by(symbol) %>%
tq_transmute(select = adjusted,
mutate_fun = periodReturn,
period = "daily",
type = "log",
col_rename='returns') %>%
separate(date, into = c('year', 'month', 'day'))
returnsMonthly <- stockPrices %>%
group_by(symbol) %>%
tq_transmute(select = adjusted,
mutate_fun = periodReturn,
period = "monthly",
type = "log",
col_rename='returns') %>%
separate(date, into = c('year', 'month', 'day'))
returnsMonthly$Help <- paste(returnsMonthly$symbol, returnsMonthly$year, returnsMonthly$month)
returnsYearly <- stockPrices %>%
group_by(symbol) %>%
tq_transmute(select = adjusted,
mutate_fun = periodReturn,
period = "yearly",
type = "log",
col_rename='returns') %>%
separate(date, into = c('year', 'month', 'day'))
returnsYearly$Help <- paste(returnsYearly$symbol, returnsYearly$year)
volMonthly <- returnsDaily %>%
group_by(symbol, year, month) %>%
summarise(sd = sd(returns)) %>%
arrange(symbol, year, month)
volMonthly$Help <- paste(volMonthly$symbol, volMonthly$year, volMonthly$month)
volYearly <- returnsDaily %>%
group_by(symbol, year) %>%
summarise(sd = sd(returns)) %>%
arrange(symbol)
volYearly$Help <- paste(volYearly$symbol, volYearly$year)
dataYearly <- left_join(returnsYearly, volYearly, by = c("Help" = "Help"))
dataYearly <- dataYearly %>%
select('symbol.x','year.x','returns','sd') %>%
rename('symbol'='symbol.x', 'year'='year.x' )
dataMonthly <- left_join(returnsMonthly, volMonthly, by = c("Help" = "Help"))
dataMonthly <- dataMonthly %>%
select('symbol.x','year.x','month.x','returns','sd') %>%
rename('symbol'='symbol.x', 'month' = 'month.x','year'='year.x' )
dataMonthly$YrMo <- paste(dataMonthly$year, dataMonthly$month, sep = "")
dataMonthly <- dataMonthly %>% relocate('symbol','YrMo','year','month','returns','sd')
save(dataYearly, file="YearlyReturnsSDsp500-4year.Rdata")
save(dataMonthly, file="MonthlyReturnsSDsp500-4year.Rdata")
input = data.frame(start_date = '2019-12-03', end_date='2020-04-05',num_clusters=3)
dataMonthly_subset =  dataMonthly %>%
filter(YrMo >= format(as.Date(input$start_date, format="%Y-%m-%d"),"%Y%m")
& YrMo <= format(as.Date(input$end_date, format="%Y-%m-%d"),"%Y%m")) %>%
select('symbol', 'YrMo', 'returns','sd')
mls <- split(dataMonthly_subset, f=dataMonthly_subset$YrMo)
myv <- c("returns","sd")
kls <- lapply(X=mls, FUN=function(x){x$clust <- kmeans(x[, myv],
centers=2)$cluster ; return(x)})
finaldf <- do.call(rbind, kls)
dataMonthly_subset$clusters = clustersMO$cluster
dataMonthly_subset$clusters = finaldf$cluster
dataMonthly_subset$clusters = finaldf$clust
finaldf
dataMonthly_subset
finaldf <- do.call(rbind, kls)
finaldf
clustersbyMo <- finaldf %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol")) %>%
drop_na() %>%
filter(SectorF == input$selSector)
sp500Sectors = read.csv("constituents_csv.csv") %>%
mutate(sectorF = as.factor(Sector)) %>%
mutate(sectorNumeric = as.numeric(sectorF))
stockInfo = sp500Sectors %>% select(Symbol, sectorF)
clustersbyMo <- finaldf %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol")) %>%
drop_na() %>%
filter(SectorF == input$selSector)
input = data.frame(start_date = '2019-12-03', end_date='2020-04-05',num_clusters=3, selSector='Materials')
clustersbyMo <- finaldf %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol")) %>%
drop_na() %>%
filter(SectorF == input$selSector)
View(input)
finaldf <- finaldf %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol")) %>%
drop_na()
finaldf
finaldf <- finaldf %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol")) %>%
drop_na() %>%
filter(sectorF == input$selSector)
finaldf <- finaldf %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol")) %>%
drop_na()
finaldf
finaldf <- finaldf %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol")) %>%
drop_na() %>%
filter(sectorF = input$selSector)
finaldf <- finaldf %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol")) %>%
drop_na()
dataMonthly_subset$clusters = finaldf$clust
#require(caret)
#require(quantmod)
require(dplyr)
require(tidyverse)
require(tidyquant)
require(lubridate)
require(ggplot2)
require(reshape2)
require(dtw)
require(dtwclust)
require(TSclust)
require(timetk)
require(cluster)
require(factoextra)
require(dendextend)
rm(list=ls())
#Get Stock Index
stockIndex = tq_index("SP500") #SP500
#Fix stock symbols
stockIndex$symbolFixed = gsub("\\.", "-",stockIndex$symbol)
#Get Quantitative Data
startDate = "2017-01-01"
endDate = "2021-02-28"
#complete_cases = TRUE - removes symbols that return an NA
stockPrices <- tq_get(stockIndex$symbolFixed, get = "stock.prices", from = startDate, to =endDate, complete_cases = TRUE )
load("stockDatasp500-4year.Rdata")
sp500Sectors = read.csv("constituents_csv.csv") %>%
mutate(sectorF = as.factor(Sector)) %>%
mutate(sectorNumeric = as.numeric(sectorF))
stockInfo = sp500Sectors %>% select(Symbol, sectorF)
returnsDaily <- stockPrices %>%
group_by(symbol) %>%
tq_transmute(select = adjusted,
mutate_fun = periodReturn,
period = "daily",
type = "log",
col_rename='returns') %>%
separate(date, into = c('year', 'month', 'day'))
returnsMonthly <- stockPrices %>%
group_by(symbol) %>%
tq_transmute(select = adjusted,
mutate_fun = periodReturn,
period = "monthly",
type = "log",
col_rename='returns') %>%
separate(date, into = c('year', 'month', 'day'))
returnsMonthly$Help <- paste(returnsMonthly$symbol, returnsMonthly$year, returnsMonthly$month)
returnsYearly <- stockPrices %>%
group_by(symbol) %>%
tq_transmute(select = adjusted,
mutate_fun = periodReturn,
period = "yearly",
type = "log",
col_rename='returns') %>%
separate(date, into = c('year', 'month', 'day'))
returnsYearly$Help <- paste(returnsYearly$symbol, returnsYearly$year)
volMonthly <- returnsDaily %>%
group_by(symbol, year, month) %>%
summarise(sd = sd(returns)) %>%
arrange(symbol, year, month)
volMonthly$Help <- paste(volMonthly$symbol, volMonthly$year, volMonthly$month)
volYearly <- returnsDaily %>%
group_by(symbol, year) %>%
summarise(sd = sd(returns)) %>%
arrange(symbol)
volYearly$Help <- paste(volYearly$symbol, volYearly$year)
dataYearly <- left_join(returnsYearly, volYearly, by = c("Help" = "Help"))
dataYearly <- dataYearly %>%
select('symbol.x','year.x','returns','sd') %>%
rename('symbol'='symbol.x', 'year'='year.x' )
dataMonthly <- left_join(returnsMonthly, volMonthly, by = c("Help" = "Help"))
dataMonthly <- dataMonthly %>%
select('symbol.x','year.x','month.x','returns','sd') %>%
rename('symbol'='symbol.x', 'month' = 'month.x','year'='year.x' )
dataMonthly$YrMo <- paste(dataMonthly$year, dataMonthly$month, sep = "")
dataMonthly <- dataMonthly %>% relocate('symbol','YrMo','year','month','returns','sd')
save(dataYearly, file="YearlyReturnsSDsp500-4year.Rdata")
save(dataMonthly, file="MonthlyReturnsSDsp500-4year.Rdata")
input = data.frame(start_date = '2019-12-03', end_date='2020-04-05',num_clusters=3, selSector='Materials')
dataMonthly_subset =  dataMonthly %>%
filter(YrMo >= format(as.Date(input$start_date, format="%Y-%m-%d"),"%Y%m")
& YrMo <= format(as.Date(input$end_date, format="%Y-%m-%d"),"%Y%m")) %>%
select('symbol', 'YrMo', 'returns','sd')
mls <- split(dataMonthly_subset, f=dataMonthly_subset$YrMo)
myv <- c("returns","sd")
kls <- lapply(X=mls, FUN=function(x){x$clust <- kmeans(x[, myv],
centers=2)$cluster ; return(x)})
finaldf <- do.call(rbind, kls)
dataMonthly_subset$clusters = finaldf$clust
dataMonthly_subset
dataMonthly_subset2 <- dataMonthly_subset %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol")) %>%
drop_na()
dataMonthly_subset2
dataMonthly_subset3 <- dataMonthly_subset2 %>%
filter(sectorF == input$selSector)
dataMonthly_subset3
dataMonthly_subset4 <- dataMonthly_subset %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol")) %>%
drop_na() %>%
filter(sectorF == input$selSector)
dataMonthly_subset4
input = data.frame(start_date = '2019-12-03', end_date='2020-04-05',num_clusters=3, selSector='All')
dataMonthly_subset4 <- dataMonthly_subset %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol")) %>%
drop_na() %>%
filter(sectorF == input$selSector)
dataMonthly_subset4 <- dataMonthly_subset %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol")) %>%
drop_na() %>%
{ if(input$selSector = 'All') drop_na() else filter(sectorF == input$selSector)}
dataMonthly_subset4 <- dataMonthly_subset %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol")) %>%
drop_na() %>%
{ if(input$selSector == 'All') drop_na() else filter(sectorF == input$selSector)}
dataMonthly_subset4 <- dataMonthly_subset %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol")) %>%
drop_na() %>%
{ if(input$selSector == 'All') else filter(sectorF == input$selSector)}
dataMonthly_subset4 <- dataMonthly_subset %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol")) %>%
{ if(input$selSector == 'All')drop_na()  else filter(sectorF == input$selSector)}
filter( if (input$selSector  != "") { sectorF == sectorF } else {  sectorF == sectorF  })
dataMonthly_subset4 <- dataMonthly_subset %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol")) %>%
{ if(input$selSector == 'All') drop_na()  else filter(sectorF == input$selSector)}
dataMonthly_subset4 <- dataMonthly_subset %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol")) %>%
filter( if (input$selSector  != "") { sectorF == sectorF } else {  sectorF == sectorF  })
dataMonthly_subset4
dataMonthly_subset
dataMonthly_subset2
dataMonthly_subset4
dataMonthly_subset2
dataMonthly_subset4
View(dataMonthly_subset4)
dataMonthly_subset4 <- dataMonthly_subset %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol"))%>%
filter( if (input$selSector  != "") { sectorF == sectorF } else {  sectorF == sectorF  }) %>%
drop_na()
library(shiny); runApp('apptesting2.R')
#require(caret)
#require(quantmod)
require(dplyr)
require(tidyverse)
require(tidyquant)
require(lubridate)
require(ggplot2)
require(reshape2)
require(dtw)
require(dtwclust)
require(TSclust)
require(timetk)
require(cluster)
require(factoextra)
require(dendextend)
rm(list=ls())
load("stockDatasp500-4year.Rdata")
#require(caret)
#require(quantmod)
require(dplyr)
require(tidyverse)
require(tidyquant)
require(lubridate)
require(ggplot2)
require(reshape2)
require(dtw)
require(dtwclust)
require(TSclust)
require(timetk)
require(cluster)
require(factoextra)
require(dendextend)
rm(list=ls())
load("stockDatasp500-4year.Rdata")
sp500Sectors = read.csv("constituents_csv.csv") %>%
mutate(sectorF = as.factor(Sector)) %>%
mutate(sectorNumeric = as.numeric(sectorF))
stockInfo = sp500Sectors %>% select(Symbol, sectorF)
load("YearlyReturnsSDsp500-4year.Rdata")
load("MonthlyReturnsSDsp500-4year.Rdata")
input = data.frame(start_date = '2019-12-03', end_date='2020-04-05',num_clusters=3, selSector='All')
dataMonthly_subset =  dataMonthly %>%
filter(YrMo >= format(as.Date(input$start_date, format="%Y-%m-%d"),"%Y%m")
& YrMo <= format(as.Date(input$end_date, format="%Y-%m-%d"),"%Y%m")) %>%
select('symbol', 'YrMo', 'returns','sd')
mls <- split(dataMonthly_subset, f=dataMonthly_subset$YrMo)
myv <- c("returns","sd")
kls <- lapply(X=mls, FUN=function(x){x$clust <- kmeans(x[, myv],
centers=2)$cluster ; return(x)})
finaldf <- do.call(rbind, kls)
dataMonthly_subset$clusters = finaldf$clust
dataMonthly_subset4 <- dataMonthly_subset %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol"))%>%
filter( if (input$selSector  != "") { sectorF == sectorF } else {  sectorF == sectorF  }) %>%
drop_na()
dataMonthly_subset2 <- dataMonthly_subset %>%
left_join(stockInfo, ., by = c("Symbol" = "symbol")) %>%
drop_na()
runApp('apptesting2.R')
